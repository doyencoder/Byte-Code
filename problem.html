<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="static/favicon.ico">
    <title>CP ARENA - Problems</title>
    <link rel="stylesheet" href="static/styleproblem.css">
    <link rel="stylesheet" href="static/style.css">
</head>

<body>
    <div class="zero">
        <div class="main" id="navbar">
            <nav>
                <span><img width="200px" src="images/logo.png" alt=""></span>
                <div class="separation"></div>
                <ul class="nav-links">
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="contest.html">Contests</a></li>
                    <li><a href="problem.html" id="contestnav">Problems</a></li>
                    <li><a href="profile.html">Profile</a></li>
                </ul>
                <div class="separation"></div>
                <div class="nav-buttons">
                    <button id="logoutbtn" style="display: flex;">Logout</button>
                </div>
                <div class="menu-icon" onclick="toggleMenu()">&#9776;</div>
            </nav>

            <div class="mobile-menu">
                <span class="close-btn" onclick="closeMenu()">&#10006;</span>
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="contest.html">Contests</a></li>
                    <li><a href="problem.html">Problems</a></li>
                    <li><a href="profile.html">Profile</a></li>
                </ul>
                <div class="nav-buttons2">
                    <button id="logoutbtn" style="display: flex;">Logout</button>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Problem List -->
            <div class="problem-list">
                <h2>Problems</h2>
                <div class="problem-header">
                    <button class="refresh-btn" onclick="refreshStatus()">ðŸ”„ Refresh Status</button>
                    <div class="page-controls">
                        <button onclick="prevPage()" class="page-btn">Previous</button>
                        <span id="page-info">Page 1</span>
                        <button onclick="nextPage()" class="page-btn">Next</button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Problem</th>
                            <th>Rating</th>
                            <th>Tags</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="problemTable">
                        <!-- Problems will be added dynamically -->
                    </tbody>
                </table>
                <div id="loading" class="loading">Loading problems...</div>
            </div>

            <!-- Filters -->
            <div class="filters-section">
                <h2>Filters</h2>
                
                <div class="filter-group">
                    <label for="ratingFilter">Rating:</label>
                    <select id="ratingFilter" onchange="filterProblems()">
                        <option value="all">All Ratings</option>
                        <option value="800">800</option>
                        <option value="900">900</option>
                        <option value="1000">1000</option>
                        <option value="1100">1100</option>
                        <option value="1200">1200</option>
                        <option value="1300">1300</option>
                        <option value="1400">1400</option>
                        <option value="1500">1500</option>
                        <option value="1600">1600</option>
                        <option value="1700">1700</option>
                        <option value="1800">1800</option>
                        <option value="1900">1900</option>
                        <option value="2000">2000</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="tagFilter">Tags:</label>
                    <select id="tagFilter" onchange="filterProblems()">
                        <option value="all">All Tags</option>
                        <option value="implementation">Implementation</option>
                        <option value="dp">Dynamic Programming</option>
                        <option value="math">Math</option>
                        <option value="greedy">Greedy</option>
                        <option value="dfs">DFS and Similar</option>
                        <option value="data-structures">Data Structures</option>
                        <option value="strings">Strings</option>
                        <option value="binary-search">Binary Search</option>
                        <option value="sorting">Sorting</option>
                        <option value="graphs">Graphs</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="statusFilter">Status:</label>
                    <select id="statusFilter" onchange="filterProblems()">
                        <option value="all">All</option>
                        <option value="solved">Solved</option>
                        <option value="unsolved">Unsolved</option>
                    </select>
                </div>
                
                <button class="reset-btn" onclick="resetFilters()">Reset Filters</button>
                
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let allProblems = [];
        let currentProblems = [];
        let currentPage = 1;
        const problemsPerPage = 15;
        const currentUser = {
            username: "User123",
            solvedProblems: new Set() // Store problem IDs that are solved
        };
        
        // Function to fetch problems from Codeforces
        async function fetchProblems() {
            document.getElementById("loading").style.display = "block";
            
            try {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                allProblems = [];
                
                // Common problem tags
                const tags = [
                    "implementation", "dp", "math", "greedy", 
                    "dfs", "data-structures", "strings", 
                    "binary-search", "sorting", "graphs"
                ];
                
                // Create problems with ratings from 800 to 2000
                for (let rating = 800; rating <= 2000; rating += 100) {
                    for (let i = 1; i <= 30; i++) {
                        // Assign 1-3 random tags to each problem
                        const numTags = Math.floor(Math.random() * 3) + 1;
                        const problemTags = [];
                        
                        for (let j = 0; j < numTags; j++) {
                            const randomTag = tags[Math.floor(Math.random() * tags.length)];
                            if (!problemTags.includes(randomTag)) {
                                problemTags.push(randomTag);
                            }
                        }
                        
                        const problemId = `${rating}-${i}`;
                        allProblems.push({
                            id: problemId,
                            title: `Problem ${String.fromCharCode(65 + (i % 26))}${Math.floor(i/26)}`,
                            rating: rating,
                            tags: problemTags,
                            status: currentUser.solvedProblems.has(problemId) ? "solved" : "unsolved",
                            link: `https://codeforces.com/problemset/problem/${Math.floor(Math.random() * 1000)}/${String.fromCharCode(65 + (i % 26))}`
                        });
                    }
                }
                
                // Load from localStorage if available
                loadUserProgress();
                
                // Update UI
                filterProblems();
                updateUserInfo();
                
            } catch (error) {
                console.error("Error fetching problems:", error);
            } finally {
                document.getElementById("loading").style.display = "none";
            }
        }
        
        // Function to display problems on the current page
        function displayProblems() {
            const startIdx = (currentPage - 1) * problemsPerPage;
            const endIdx = startIdx + problemsPerPage;
            const pageProblems = currentProblems.slice(startIdx, endIdx);
            
            const tableBody = document.getElementById("problemTable");
            tableBody.innerHTML = "";
            
            if (pageProblems.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="4" class="no-results">No problems match your filters</td></tr>`;
                return;
            }
            
            pageProblems.forEach(problem => {
                const row = `<tr data-id="${problem.id}">
                    <td><a href="${problem.link}" target="_blank">${problem.title}</a></td>
                    <td>${problem.rating}</td>
                    <td>${problem.tags.join(", ")}</td>
                    <td class="${problem.status}">${problem.status.charAt(0).toUpperCase() + problem.status.slice(1)}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
            
            document.getElementById("page-info").textContent = `Page ${currentPage} of ${Math.ceil(currentProblems.length / problemsPerPage)}`;
        }
        
        // Navigation functions
        function nextPage() {
            const maxPage = Math.ceil(currentProblems.length / problemsPerPage);
            if (currentPage < maxPage) {
                currentPage++;
                displayProblems();
                window.scrollTo(0, 0);
            }
        }
        
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                displayProblems();
                window.scrollTo(0, 0);
            }
        }
        
        // Function to filter problems based on rating, tags & status
        function filterProblems() {
            const selectedRating = document.getElementById("ratingFilter").value;
            const selectedTag = document.getElementById("tagFilter").value;
            const selectedStatus = document.getElementById("statusFilter").value;
            
            currentProblems = allProblems.filter(problem => {
                const ratingMatch = selectedRating === "all" || problem.rating == selectedRating;
                const tagMatch = selectedTag === "all" || problem.tags.includes(selectedTag);
                const statusMatch = selectedStatus === "all" || problem.status === selectedStatus;
                return ratingMatch && tagMatch && statusMatch;
            });
            
            // Reset to first page when filtering
            currentPage = 1;
            displayProblems();
        }
        
        // Function to reset all filters
        function resetFilters() {
            document.getElementById("ratingFilter").value = "all";
            document.getElementById("tagFilter").value = "all";
            document.getElementById("statusFilter").value = "all";
            filterProblems();
        }
        
        // Function to refresh problem status
        function refreshStatus() {
            // In a real implementation, you would:
            // 1. Fetch the user's submission history from Codeforces API
            // 2. Update the status of problems based on the submission history
            
            // For demonstration, we'll randomly mark some problems as solved
            if (allProblems.length > 0) {
                const unsolved = allProblems.filter(p => p.status === "unsolved");
                if (unsolved.length > 0) {
                    // Randomly mark 1-5 problems as solved
                    const numToSolve = Math.min(Math.floor(Math.random() * 5) + 1, unsolved.length);
                    
                    for (let i = 0; i < numToSolve; i++) {
                        const idx = Math.floor(Math.random() * unsolved.length);
                        const problem = unsolved[idx];
                        problem.status = "solved";
                        currentUser.solvedProblems.add(problem.id);
                        unsolved.splice(idx, 1);
                    }
                    
                    // Save progress to localStorage
                    saveUserProgress();
                    
                    // Update UI
                    filterProblems();
                    updateUserInfo();
                    
                    alert(`Refreshed! ${numToSolve} new problems marked as solved.`);
                } else {
                    alert("Amazing! You've solved all the problems!");
                }
            }
        }
        
        // Functions to save and load user progress
        function saveUserProgress() {
            localStorage.setItem('solvedProblems', JSON.stringify([...currentUser.solvedProblems]));
        }
        
        function loadUserProgress() {
            const savedProblems = localStorage.getItem('solvedProblems');
            if (savedProblems) {
                currentUser.solvedProblems = new Set(JSON.parse(savedProblems));
                
                // Update problem statuses
                allProblems.forEach(problem => {
                    if (currentUser.solvedProblems.has(problem.id)) {
                        problem.status = "solved";
                    }
                });
            }
        }
        
        // Initialize with all problems
        document.addEventListener("DOMContentLoaded", () => {
            fetchProblems();
            
            // Handle browser page refresh
            window.addEventListener('beforeunload', () => {
                saveUserProgress();
            });
        });
    </script>
    <script src="static/script.js"></script>
</body>

</html>